<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Links</title>
    <link rel="stylesheet" href="links.css">
</head>
<body>
    <img id="bgImage" class="background-image" alt="Background">
    <h1 id="overlayText" class="text-overlay"></h1>
    
    <header class="header">
        <div class="title-box">
            <p class="title">[C--M] Connor MacDonald, Applied Artist & Designer</p>
        </div>

        <div class="readout-box">
            <p class="readout" id="fileReadout"></p>
        </div>
        
        <nav class="nav-box">
            <button onclick="window.location.href='../../index.html'" class="nav-link">[back]</button>
            <button id="rerollButton" class="nav-link">[reroll]</button>
            <div style="width: 100%; height: 0;"></div>
            <a href="#" class="nav-link">[why like this]</a>
            <a href="https://www.are.na/connor-macdonald-aygwd2z45ek" class="nav-link">[★★]</a>
            <a href="https://www.instagram.com/sensoryworks_" class="nav-link">[insta]</a>
            <a href="https://github.com/seee-m" class="nav-link">[github]</a>
            

        </nav>
    </header>

    <script>
        const TYPING_SPEED = 50; // milliseconds per character
        const random = arr => arr[Math.floor(Math.random() * arr.length)];
        
        let currentSlogan = '';
        let currentImageFile = '';
        let colorPairs = [];
        let slogans = [];
        let images = [];
        let typewriterTimeout;

        async function loadColors() {
            try {
                const response = await fetch('colors.txt');
                const text = await response.text();
                colorPairs = text.split('\n')
                    .filter(line => line.trim())
                    .map(line => {
                        const [fill, stroke] = line.split(',').map(c => c.trim());
                        return { fill, stroke };
                    });
            } catch (error) {
                console.error('Error loading colors:', error);
            }
        }

        async function loadImages() {
            try {
                const response = await fetch('/media/background/background.txt');
                const text = await response.text();
                images = text.split('\n').filter(line => line.trim()).map(img => `/media/background/${img}`);
            } catch (error) {
                console.error('Error loading images:', error);
            }
        }

        async function loadSlogans() {
            try {
                const response = await fetch('slogans.txt');
                const text = await response.text();
                slogans = text.split('\n').filter(line => line.trim());
            } catch (error) {
                console.error('Error loading slogans:', error);
            }
        }

        // Typewriter effect
        function typeWriter(text, element) {
            // Clear any existing timeout
            if (typewriterTimeout) {
                clearTimeout(typewriterTimeout);
            }
            
            element.textContent = '';
            let index = 0;
            
            function type() {
                if (index < text.length) {
                    element.textContent += text.charAt(index);
                    index++;
                    typewriterTimeout = setTimeout(type, TYPING_SPEED);
                }
            }
            
            type();
        }

        function applyColors(colors) {
            const textElement = document.getElementById('overlayText');
            const titleBox = document.querySelector('.title-box');
            textElement.style.color = colors.fill;
            textElement.style.webkitTextStroke = `0.018em ${colors.stroke}`;
            titleBox.style.backgroundColor = colors.fill;
        }

        function randomize() {
            if (colorPairs.length > 0) {
                applyColors(random(colorPairs));
            }
            
            if (images.length > 0) {
                const imagePath = random(images);
                document.getElementById('bgImage').src = imagePath;
                currentImageFile = imagePath.replace('/media/background/', '');
                
                // Use typewriter effect for filename
                const readoutElement = document.getElementById('fileReadout');
                typeWriter(currentImageFile, readoutElement);
            }
            
            if (slogans.length > 0) {
                displayText(random(slogans));
            }
        }

        function displayText(slogan) {
            currentSlogan = slogan;
            const textElement = document.getElementById('overlayText');
            
            // On mobile, split into one word per line for better sizing
            if (window.innerWidth <= 600) {
                textElement.innerHTML = slogan.split(' ').join('<br>');
                
                // Position vertically centered between nav-box bottom and screen bottom
                setTimeout(() => {
                    const navBox = document.querySelector('.nav-box');
                    if (navBox) {
                        const navBoxRect = navBox.getBoundingClientRect();
                        const navBoxBottom = navBoxRect.bottom;
                        const screenBottom = window.innerHeight;
                        const centerPoint = navBoxBottom + (screenBottom - navBoxBottom) / 2;
                        
                        textElement.style.top = centerPoint + 'px';
                    }
                    
                    const maxHeight = window.innerHeight * 0.6; // 60vh max
                    const maxWidth = window.innerWidth - 48; // Account for 1.5rem padding on each side
                    
                    // Reset to let clamp work
                    textElement.style.fontSize = '';
                    
                    // If it overflows height or width, scale it down
                    let currentSize = parseFloat(getComputedStyle(textElement).fontSize);
                    const minSize = 32; // 2rem minimum
                    
                    while ((textElement.scrollHeight > maxHeight || textElement.scrollWidth > maxWidth) && currentSize > minSize) {
                        currentSize -= 2;
                        textElement.style.fontSize = currentSize + 'px';
                    }
                }, 50);
            } else {
                textElement.style.fontSize = '';
                textElement.style.top = '';
                textElement.textContent = slogan;
            }
        }

        async function init() {
            await Promise.all([loadColors(), loadImages(), loadSlogans()]);
            randomize();
        }

        document.getElementById('rerollButton').addEventListener('click', randomize);

        window.addEventListener('resize', () => {
            clearTimeout(window.resizeTimeout);
            window.resizeTimeout = setTimeout(() => {
                if (currentSlogan) displayText(currentSlogan);
            }, 150);
        });

        init();
    </script>
</body>
</html>