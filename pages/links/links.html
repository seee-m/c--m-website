<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Links</title>
    <link rel="stylesheet" href="links.css">
</head>
<body>
    <img id="bgImage" class="background-image" alt="Background">
    <h1 id="overlayText" class="text-overlay"></h1>
    
    <header class="header">
        <div class="title-box">
            <p class="title">[C--M] Connor MacDonald, Applied Artist & Designer</p>
        </div>

        <div class="readout-box">
            <p class="readout" id="fileReadout"></p>
        </div>
        
        <nav class="nav-box">
            <button onclick="window.location.href='../../index.html'" class="nav-link">[back]</button>
            <button id="rerollButton" class="nav-link">[reroll]</button>
            <div style="width: 100%; height: 0;"></div>
            <a href="#" class="nav-link">[link 01]</a>
            <a href="#" class="nav-link">[link 02]</a>
            <a href="#" class="nav-link">[link 03]</a>
            <a href="#" class="nav-link">[link 04]</a>
            <a href="#" class="nav-link">[link 05]</a>
            <a href="#" class="nav-link">[link 06]</a>
            <a href="#" class="nav-link">[link 07]</a>
            <a href="#" class="nav-link">[link 08]</a>
            <a href="#" class="nav-link">[link 09]</a>
            <a href="#" class="nav-link">[link 10]</a>
            <a href="#" class="nav-link">[link 11]</a>
            <a href="#" class="nav-link">[link 12]</a>
            <a href="#" class="nav-link">[link 13]</a>
            <a href="#" class="nav-link">[link 14]</a>
            <a href="#" class="nav-link">[link 15]</a>
        </nav>
    </header>

    <script>
        const TYPING_SPEED = 50; // milliseconds per character
        const random = arr => arr[Math.floor(Math.random() * arr.length)];
        
        // Get thumbnail path from full path
        function getThumbPath(fullPath) {
            const parts = fullPath.split('/');
            const filename = parts.pop();
            const baseName = filename.replace(/\.[^/.]+$/, '');
            parts.push('thumbs', `${baseName}.jpg`);
            return parts.join('/');
        }
        
        // Progressive image loader
        function loadProgressively(imgElement, fullSrc) {
            const thumbSrc = getThumbPath(fullSrc);
            
            // Load thumbnail immediately with pixelated rendering
            imgElement.src = thumbSrc;
            imgElement.style.imageRendering = 'pixelated';
            imgElement.style.imageRendering = '-moz-crisp-edges';
            imgElement.style.imageRendering = 'crisp-edges';
            
            // Preload full image
            const fullImg = new Image();
            fullImg.onload = () => {
                imgElement.src = fullSrc;
                imgElement.style.imageRendering = 'auto';
            };
            fullImg.src = fullSrc;
        }
        
        let currentSlogan = '';
        let currentImageFile = '';
        let colorPairs = [];
        let slogans = [];
        let images = [];
        let typewriterTimeout;

        async function loadColors() {
            try {
                const response = await fetch('colors.txt');
                const text = await response.text();
                colorPairs = text.split('\n')
                    .filter(line => line.trim())
                    .map(line => {
                        const [fill, stroke] = line.split(',').map(c => c.trim());
                        return { fill, stroke };
                    });
            } catch (error) {
                console.error('Error loading colors:', error);
            }
        }

        async function loadImages() {
            try {
                const response = await fetch('/media/background/background.txt');
                const text = await response.text();
                images = text.split('\n').filter(line => line.trim()).map(img => `/media/background/${img}`);
            } catch (error) {
                console.error('Error loading images:', error);
            }
        }

        async function loadSlogans() {
            try {
                const response = await fetch('slogans.txt');
                const text = await response.text();
                slogans = text.split('\n').filter(line => line.trim());
            } catch (error) {
                console.error('Error loading slogans:', error);
            }
        }

        // Typewriter effect
        function typeWriter(text, element) {
            // Clear any existing timeout
            if (typewriterTimeout) {
                clearTimeout(typewriterTimeout);
            }
            
            element.textContent = '';
            let index = 0;
            
            function type() {
                if (index < text.length) {
                    element.textContent += text.charAt(index);
                    index++;
                    typewriterTimeout = setTimeout(type, TYPING_SPEED);
                }
            }
            
            type();
        }

        function applyColors(colors) {
            const textElement = document.getElementById('overlayText');
            const titleBox = document.querySelector('.title-box');
            textElement.style.color = colors.fill;
            textElement.style.webkitTextStroke = `0.018em ${colors.stroke}`;
            titleBox.style.backgroundColor = colors.fill;
        }

        function randomize() {
            if (colorPairs.length > 0) {
                applyColors(random(colorPairs));
            }
            
            if (images.length > 0) {
                const imagePath = random(images);
                loadProgressively(document.getElementById('bgImage'), imagePath);
                currentImageFile = imagePath.replace('/media/background/', '');
                
                // Use typewriter effect for filename
                const readoutElement = document.getElementById('fileReadout');
                typeWriter(currentImageFile, readoutElement);
            }
            
            if (slogans.length > 0) {
                displayText(random(slogans));
            }
        }

        function displayText(slogan) {
            currentSlogan = slogan;
            const textElement = document.getElementById('overlayText');
            
            // On mobile, split into one word per line for better sizing
            if (window.innerWidth <= 600) {
                textElement.innerHTML = slogan.split(' ').join('<br>');
                
                // Dynamically adjust size based on word count to prevent overflow
                setTimeout(() => {
                    const wordCount = slogan.split(' ').length;
                    const maxHeight = window.innerHeight * 0.7; // 70vh
                    
                    // Reset to let clamp work
                    textElement.style.fontSize = '';
                    
                    // If it overflows, scale it down
                    if (textElement.scrollHeight > maxHeight) {
                        let currentSize = parseFloat(getComputedStyle(textElement).fontSize);
                        while (textElement.scrollHeight > maxHeight && currentSize > 30) {
                            currentSize -= 2;
                            textElement.style.fontSize = currentSize + 'px';
                        }
                    }
                }, 50);
            } else {
                textElement.style.fontSize = '';
                textElement.textContent = slogan;
            }
        }

        async function init() {
            await Promise.all([loadColors(), loadImages(), loadSlogans()]);
            randomize();
        }

        document.getElementById('rerollButton').addEventListener('click', randomize);

        window.addEventListener('resize', () => {
            clearTimeout(window.resizeTimeout);
            window.resizeTimeout = setTimeout(() => {
                if (currentSlogan) displayText(currentSlogan);
            }, 150);
        });

        init();
    </script>
</body>
</html>