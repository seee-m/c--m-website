name: Generate Image Lists

on:
  push:
    paths:
      - 'media/background/**'
      - 'media/work/**'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  generate-lists:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Generate image list files
        run: |
          python << 'EOF'
          import os
          
          def generate_image_list(directory, output_file):
              """Generate a text file listing all images in a directory"""
              if not os.path.exists(directory):
                  print(f"Directory not found: {directory}")
                  return
              
              # Get all image files, excluding the thumbs subdirectory
              image_extensions = ('.jpg', '.jpeg', '.png', '.gif', '.webp')
              images = []
              
              for filename in os.listdir(directory):
                  filepath = os.path.join(directory, filename)
                  # Skip if it's a directory or not an image
                  if os.path.isdir(filepath) or not filename.lower().endswith(image_extensions):
                      continue
                  images.append(filename)
              
              # Sort alphabetically for consistency
              images.sort()
              
              # Write to file
              output_path = os.path.join(directory, output_file)
              with open(output_path, 'w') as f:
                  f.write('\n'.join(images))
              
              print(f"✓ Generated {output_path} with {len(images)} images")
          
          # Generate both list files
          print("Generating image lists...")
          generate_image_list('media/background', 'background.txt')
          generate_image_list('media/work', 'work.txt')
          
          print("\n✓ All image lists generated!")
          EOF
          
      - name: Commit and push image lists
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add media/background/background.txt media/work/work.txt
          git diff --quiet && git diff --staged --quiet || (git commit -m "📝 Auto-generate image list files" && git push)
